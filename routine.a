; ACME 0.96.4
; 
; [FRENCH TOUCH]
; code: GROUiK
;
; 04/2021
;
; v0.09 - BETA 1
; v0.08 - TEST 7
; v0.07 - TEST 6 => swap AN3 fixed / final background (?)
; v0.06 - TEST 5 => swap AN3 (bug)
; v0.05 - TEST 4 => GR colors + slice
; v0.04 - TEST 3
; v0.03 - TEST 2 => add starfield
; v0.02 - TEST 2 => 4 bars (+reorganized code)
; v0.01 - TEST 1 => 2 bars
;
!cpu 6502
!convtab "a2txt.bin" ; 
!sl "lbl_routine.txt"

; include
;!source "include.a"

           	*= $6000 ; ORG = $6000

; =============================================================================
; SYSTEM/CONSTANT

; =============================================================================
; ZERO PAGE individual

; =================================================================================================
ROUTINE
ROUTINE_INIT	JMP INIT
; =================================================================================================
ROUTINE_RUN	; x = 0
		; first DISPLAY LINE
!zone
; -------------------------------------------------------------------------------------------------
; DISPLAY PART
		LDY #33
		; PART I - lines 0 - 49
LLines_P1		
		; 65 cycles
		LSR TBUFFER,X			; 7 (6502 ONLY! 6 if 65C02)	; current line	
		BCS P1_1				; 2/3			; = 1 ?
		BNE P1_2				; 2/3			; = 2 ?
					
		; 7+2+2 = 11
mod_AN3_1
P1_0		STA $C05F				; +4
		JSR full_hgr			; +6 + [34]
		DEY				; +2
		NOP : NOP				; +4
		BEQ P2				; +2/3
		JMP LLines_P1			; +3
						; = 11 + 6 + [34] + 3 + 2 + 4 + 2 + 3 = 65

		; 7+3 = 10
P1_1		STA $C05F				; +4
		JSR full_gr			; +6 + [38]
		DEY				; +2
		BEQ P2				; +2/3
		JMP LLines_P1			; +3
						; = 10 + 6 + [38] + 2 + 2 + 2 + 3 = 65

		; 7+2+3 = 12
P1_2		STA $C05F				; +4
		STA $C056				; +4
		JSR full_gr2			; + [32]
		DEY				; +2
		BEQ P2				; +2/3
		JMP LLines_P1			; +3
						
						
P2		LDY #120				; 3+2
		
		; PART II
LLines_P2	
		; 65 cycles
		LSR TBUFFER,X			
		BCS P2_1				
		BNE P2_2							
mod_AN3_2
P2_0		STA $C05F				
		JSR full_hgr
		DEY
		NOP : NOP
		BEQ P3				
		JMP LLines_P2			

P2_1		STA $C05F
		JSR full_gr
		DEY
		BEQ P3				
		JMP LLines_P2			

		; 7+2+3 = 12
P2_2		STA $C05F				; 4
		STA $C056				; 4
		NOP : NOP : NOP : NOP		; 8
		STA $C057				; 4
		NOP : LDA $AC			; 5
		LDA #00				; 2				
		STA TBUFFER,X			; 5
		INX				; 2
		DEY				; 2
		NOP : STA $AC			; 5
		STA $C056				; 4
		STA $AC				; 3
		BEQ P3				; 2
		JMP LLines_P2			; 3
						; = 65 
		
P3		LDY #23
		
		; PART III
LLines_P3	
		; 65 cycles
		LSR TBUFFER,X				
		BCS P3_1				
		BNE P3_2							
mod_AN3_3
P3_0		STA $C05F				
		JSR full_hgr
		DEY
		NOP : NOP
		BEQ NEXT				
		JMP LLines_P3			

P3_1		STA $C05F
		JSR full_gr
		DEY
		BEQ NEXT				
		JMP LLines_P3			

P3_2		STA $C05F
		STA $C056
		JSR full_gr2
		DEY
		BEQ NEXT				
		JMP LLines_P3

NEXT		STA $C057			; restore default mode			
; -------------------------------------------------------------------------------------------------
; SCROLL PART I: swap hires colors
		DEC count
		BNE +
mod_scroll	LDA #$FF
		STA count		
		LDA mod2+1
		EOR #($5E XOR $5F)
		STA mod2+1
+
mod2		STA $C05F
; -------------------------------------------------------------------------------------------------
; RASTER BARS PART

		LDX IndexBar1		
		LDY TableSinus,X		
		LDA TableSinSens,X
		BEQ +
		LDA #$02
		!byte $2C
+		LDA #$01
		LDX #20
-		STA TBUFFER,Y		
		INY			
		DEX
		BNE -
mod_bar1_1	BIT IndexBar1			; ($E6 = INC) 
mod_bar1_2	BIT IndexBar1
		INC IndexBar1

		LDX IndexBar2		
		LDY TableSinus,X		
		LDA TableSinSens,X
		BEQ +
		LDA #$02
		!byte $2C
+		LDA #$01
		LDX #20
		STX temp
-		LDX TBUFFER,Y
		CPX #01
		BEQ +
add_bar2
		BIT TBUFFER			; ($2C= BIT / $99 = STA)	
+		INY			
		DEC temp
		BNE -
mod_bar2_1	BIT IndexBar2
mod_bar2_2	BIT IndexBar2
		INC IndexBar2

		LDX IndexBar3		
		LDY TableSinus,X		
		LDA TableSinSens,X
		BEQ +
		LDA #$02
		!byte $2C
+		LDA #$01
		LDX #20
		STX temp
-		LDX TBUFFER,Y
		CPX #01
		BEQ +
add_bar3
		BIT TBUFFER			; ($2C= BIT / $99 = STA)			
+		INY			
		DEC temp
		BNE -
mod_bar3_1	BIT IndexBar3
mod_bar3_2	BIT IndexBar3
		INC IndexBar3

		LDX IndexBar4		
		LDY TableSinus,X		
		LDA TableSinSens,X
		BEQ +
		LDA #$02
		!byte $2C
+		LDA #$01
		LDX #20
		STX temp
-		LDX TBUFFER,Y
		CPX #01
		BEQ +
add_bar4
		BIT TBUFFER			; ($2C= BIT / $99 = STA)		
+		INY			
		DEC temp
		BNE -
mod_bar4_1	BIT IndexBar4
mod_bar4_2	BIT IndexBar4
		INC IndexBar4
; -------------------------------------------------------------------------------------------------
; SCROLL PART Ib: swap hires colors (back to default)
		STA $C05F
; -------------------------------------------------------------------------------------------------
		JSR SWAPAN3
		DEC count2
		BEQ +
mod_effect1	JSR NOEFFECT
mod_effect2	JSR NOEFFECT
		RTS
; -------------------------------------------------------------------------------------------------
+		LDA #02
		STA count2
; -------------------------------------------------------------------------------------------------
; SCROLL PART II: new row/letter
		; row for current letter	
		DEC row
		BNE .next_row

		INC mod_letter+1
		BNE mod_letter
		INC mod_letter+2
mod_letter	LDX ScrollText-1
		BPL .skip
		; reinit
		LDA #>ScrollText	
		STA mod_letter+2			
		LDA #<ScrollText
		STA mod_letter+1			
		LDX ScrollText
.skip		
		LDA TNBROW, X
          	STA row
          	LDA TLINE0, X
		STA L0
          	LDA TLINE1, X
		STA L1
          	LDA TLINE2, X
		STA L2
          	LDA TLINE3, X
		STA L3
          	LDA TLINE4, X
		STA L4
		LDA TLINE5, X
		STA L5

.next_row		LSR L0
		BCS +
		LDA #$80
		!byte $2C
+		LDA #160
		STA modline0+1

		LSR L1
		BCS +
		LDA #$80
		!byte $2C
+		LDA #160
		STA modline1+1

		LSR L2
		BCS +
		LDA #$80
		!byte $2C
+		LDA #160
		STA modline2+1

		LSR L3
		BCS +
		LDA #$80
		!byte $2C
+		LDA #160
		STA modline3+1
		
		LSR L4
		BCS +
		LDA #$80
		!byte $2C
+		LDA #160
		STA modline4+1

		LSR L5
		BCS +
		LDA #$80
		!byte $2C
+		LDA #160
		STA modline5+1
; -------------------------------------------------------------------------------------------------
; SCROLL PART III - scroll text

modline0                 LDA #$AC
                 LDX $2f77
                 ORA TDECALL,X
                 STA $2f77
                 LDA TBITS,X
                 LDX $2f76
                 ORA TDECALL,X
                 STA $2f76
                 LDA TBITS,X
                 LDX $2f75
                 ORA TDECALL,X
                 STA $2f75
                 LDA TBITS,X
                 LDX $2f74
                 ORA TDECALL,X
                 STA $2f74
                 LDA TBITS,X
                 LDX $2f73
                 ORA TDECALL,X
                 STA $2f73
                 LDA TBITS,X
                 LDX $2f72
                 ORA TDECALL,X
                 STA $2f72
                 LDA TBITS,X
                 LDX $2f71
                 ORA TDECALL,X
                 STA $2f71
                 LDA TBITS,X
                 LDX $2f70
                 ORA TDECALL,X
                 STA $2f70
                 LDA TBITS,X
                 LDX $2f6f
                 ORA TDECALL,X
                 STA $2f6f
                 LDA TBITS,X
                 LDX $2f6e
                 ORA TDECALL,X
                 STA $2f6e
                 LDA TBITS,X
                 LDX $2f6d
                 ORA TDECALL,X
                 STA $2f6d
                 LDA TBITS,X
                 LDX $2f6c
                 ORA TDECALL,X
                 STA $2f6c
                 LDA TBITS,X
                 LDX $2f6b
                 ORA TDECALL,X
                 STA $2f6b
                 LDA TBITS,X
                 LDX $2f6a
                 ORA TDECALL,X
                 STA $2f6a
                 LDA TBITS,X
                 LDX $2f69
                 ORA TDECALL,X
                 STA $2f69
                 LDA TBITS,X
                 LDX $2f68
                 ORA TDECALL,X
                 STA $2f68
                 LDA TBITS,X
                 LDX $2f67
                 ORA TDECALL,X
                 STA $2f67
                 LDA TBITS,X
                 LDX $2f66
                 ORA TDECALL,X
                 STA $2f66
                 LDA TBITS,X
                 LDX $2f65
                 ORA TDECALL,X
                 STA $2f65
                 LDA TBITS,X
                 LDX $2f64
                 ORA TDECALL,X
                 STA $2f64
                 LDA TBITS,X
                 LDX $2f63
                 ORA TDECALL,X
                 STA $2f63
                 LDA TBITS,X
                 LDX $2f62
                 ORA TDECALL,X
                 STA $2f62
                 LDA TBITS,X
                 LDX $2f61
                 ORA TDECALL,X
                 STA $2f61
                 LDA TBITS,X
                 LDX $2f60
                 ORA TDECALL,X
                 STA $2f60
                 LDA TBITS,X
                 LDX $2f5f
                 ORA TDECALL,X
                 STA $2f5f
                 LDA TBITS,X
                 LDX $2f5e
                 ORA TDECALL,X
                 STA $2f5e
                 LDA TBITS,X
                 LDX $2f5d
                 ORA TDECALL,X
                 STA $2f5d
                 LDA TBITS,X
                 LDX $2f5c
                 ORA TDECALL,X
                 STA $2f5c
                 LDA TBITS,X
                 LDX $2f5b
                 ORA TDECALL,X
                 STA $2f5b
                 LDA TBITS,X
                 LDX $2f5a
                 ORA TDECALL,X
                 STA $2f5a
                 LDA TBITS,X
                 LDX $2f59
                 ORA TDECALL,X
                 STA $2f59
                 LDA TBITS,X
                 LDX $2f58
                 ORA TDECALL,X
                 STA $2f58
                 LDA TBITS,X
                 LDX $2f57
                 ORA TDECALL,X
                 STA $2f57
                 LDA TBITS,X
                 LDX $2f56
                 ORA TDECALL,X
                 STA $2f56
                 LDA TBITS,X
                 LDX $2f55
                 ORA TDECALL,X
                 STA $2f55
                 LDA TBITS,X
                 LDX $2f54
                 ORA TDECALL,X
                 STA $2f54
                 LDA TBITS,X
                 LDX $2f53
                 ORA TDECALL,X
                 STA $2f53
                 LDA TBITS,X
                 LDX $2f52
                 ORA TDECALL,X
                 STA $2f52
                 LDA TBITS,X
                 LDX $2f51
                 ORA TDECALL,X
                 STA $2f51
                 LDA TBITS,X
                 LDX $2f50
                 ORA TDECALL,X
                 STA $2f50

modline1                 LDA #$AC
                 LDX $3777
                 ORA TDECALL,X
                 STA $3777
                 LDA TBITS,X
                 LDX $3776
                 ORA TDECALL,X
                 STA $3776
                 LDA TBITS,X
                 LDX $3775
                 ORA TDECALL,X
                 STA $3775
                 LDA TBITS,X
                 LDX $3774
                 ORA TDECALL,X
                 STA $3774
                 LDA TBITS,X
                 LDX $3773
                 ORA TDECALL,X
                 STA $3773
                 LDA TBITS,X
                 LDX $3772
                 ORA TDECALL,X
                 STA $3772
                 LDA TBITS,X
                 LDX $3771
                 ORA TDECALL,X
                 STA $3771
                 LDA TBITS,X
                 LDX $3770
                 ORA TDECALL,X
                 STA $3770
                 LDA TBITS,X
                 LDX $376f
                 ORA TDECALL,X
                 STA $376f
                 LDA TBITS,X
                 LDX $376e
                 ORA TDECALL,X
                 STA $376e
                 LDA TBITS,X
                 LDX $376d
                 ORA TDECALL,X
                 STA $376d
                 LDA TBITS,X
                 LDX $376c
                 ORA TDECALL,X
                 STA $376c
                 LDA TBITS,X
                 LDX $376b
                 ORA TDECALL,X
                 STA $376b
                 LDA TBITS,X
                 LDX $376a
                 ORA TDECALL,X
                 STA $376a
                 LDA TBITS,X
                 LDX $3769
                 ORA TDECALL,X
                 STA $3769
                 LDA TBITS,X
                 LDX $3768
                 ORA TDECALL,X
                 STA $3768
                 LDA TBITS,X
                 LDX $3767
                 ORA TDECALL,X
                 STA $3767
                 LDA TBITS,X
                 LDX $3766
                 ORA TDECALL,X
                 STA $3766
                 LDA TBITS,X
                 LDX $3765
                 ORA TDECALL,X
                 STA $3765
                 LDA TBITS,X
                 LDX $3764
                 ORA TDECALL,X
                 STA $3764
                 LDA TBITS,X
                 LDX $3763
                 ORA TDECALL,X
                 STA $3763
                 LDA TBITS,X
                 LDX $3762
                 ORA TDECALL,X
                 STA $3762
                 LDA TBITS,X
                 LDX $3761
                 ORA TDECALL,X
                 STA $3761
                 LDA TBITS,X
                 LDX $3760
                 ORA TDECALL,X
                 STA $3760
                 LDA TBITS,X
                 LDX $375f
                 ORA TDECALL,X
                 STA $375f
                 LDA TBITS,X
                 LDX $375e
                 ORA TDECALL,X
                 STA $375e
                 LDA TBITS,X
                 LDX $375d
                 ORA TDECALL,X
                 STA $375d
                 LDA TBITS,X
                 LDX $375c
                 ORA TDECALL,X
                 STA $375c
                 LDA TBITS,X
                 LDX $375b
                 ORA TDECALL,X
                 STA $375b
                 LDA TBITS,X
                 LDX $375a
                 ORA TDECALL,X
                 STA $375a
                 LDA TBITS,X
                 LDX $3759
                 ORA TDECALL,X
                 STA $3759
                 LDA TBITS,X
                 LDX $3758
                 ORA TDECALL,X
                 STA $3758
                 LDA TBITS,X
                 LDX $3757
                 ORA TDECALL,X
                 STA $3757
                 LDA TBITS,X
                 LDX $3756
                 ORA TDECALL,X
                 STA $3756
                 LDA TBITS,X
                 LDX $3755
                 ORA TDECALL,X
                 STA $3755
                 LDA TBITS,X
                 LDX $3754
                 ORA TDECALL,X
                 STA $3754
                 LDA TBITS,X
                 LDX $3753
                 ORA TDECALL,X
                 STA $3753
                 LDA TBITS,X
                 LDX $3752
                 ORA TDECALL,X
                 STA $3752
                 LDA TBITS,X
                 LDX $3751
                 ORA TDECALL,X
                 STA $3751
                 LDA TBITS,X
                 LDX $3750
                 ORA TDECALL,X
                 STA $3750

modline2                 LDA #$AC
                 LDX $3f77
                 ORA TDECALL,X
                 STA $3f77
                 LDA TBITS,X
                 LDX $3f76
                 ORA TDECALL,X
                 STA $3f76
                 LDA TBITS,X
                 LDX $3f75
                 ORA TDECALL,X
                 STA $3f75
                 LDA TBITS,X
                 LDX $3f74
                 ORA TDECALL,X
                 STA $3f74
                 LDA TBITS,X
                 LDX $3f73
                 ORA TDECALL,X
                 STA $3f73
                 LDA TBITS,X
                 LDX $3f72
                 ORA TDECALL,X
                 STA $3f72
                 LDA TBITS,X
                 LDX $3f71
                 ORA TDECALL,X
                 STA $3f71
                 LDA TBITS,X
                 LDX $3f70
                 ORA TDECALL,X
                 STA $3f70
                 LDA TBITS,X
                 LDX $3f6f
                 ORA TDECALL,X
                 STA $3f6f
                 LDA TBITS,X
                 LDX $3f6e
                 ORA TDECALL,X
                 STA $3f6e
                 LDA TBITS,X
                 LDX $3f6d
                 ORA TDECALL,X
                 STA $3f6d
                 LDA TBITS,X
                 LDX $3f6c
                 ORA TDECALL,X
                 STA $3f6c
                 LDA TBITS,X
                 LDX $3f6b
                 ORA TDECALL,X
                 STA $3f6b
                 LDA TBITS,X
                 LDX $3f6a
                 ORA TDECALL,X
                 STA $3f6a
                 LDA TBITS,X
                 LDX $3f69
                 ORA TDECALL,X
                 STA $3f69
                 LDA TBITS,X
                 LDX $3f68
                 ORA TDECALL,X
                 STA $3f68
                 LDA TBITS,X
                 LDX $3f67
                 ORA TDECALL,X
                 STA $3f67
                 LDA TBITS,X
                 LDX $3f66
                 ORA TDECALL,X
                 STA $3f66
                 LDA TBITS,X
                 LDX $3f65
                 ORA TDECALL,X
                 STA $3f65
                 LDA TBITS,X
                 LDX $3f64
                 ORA TDECALL,X
                 STA $3f64
                 LDA TBITS,X
                 LDX $3f63
                 ORA TDECALL,X
                 STA $3f63
                 LDA TBITS,X
                 LDX $3f62
                 ORA TDECALL,X
                 STA $3f62
                 LDA TBITS,X
                 LDX $3f61
                 ORA TDECALL,X
                 STA $3f61
                 LDA TBITS,X
                 LDX $3f60
                 ORA TDECALL,X
                 STA $3f60
                 LDA TBITS,X
                 LDX $3f5f
                 ORA TDECALL,X
                 STA $3f5f
                 LDA TBITS,X
                 LDX $3f5e
                 ORA TDECALL,X
                 STA $3f5e
                 LDA TBITS,X
                 LDX $3f5d
                 ORA TDECALL,X
                 STA $3f5d
                 LDA TBITS,X
                 LDX $3f5c
                 ORA TDECALL,X
                 STA $3f5c
                 LDA TBITS,X
                 LDX $3f5b
                 ORA TDECALL,X
                 STA $3f5b
                 LDA TBITS,X
                 LDX $3f5a
                 ORA TDECALL,X
                 STA $3f5a
                 LDA TBITS,X
                 LDX $3f59
                 ORA TDECALL,X
                 STA $3f59
                 LDA TBITS,X
                 LDX $3f58
                 ORA TDECALL,X
                 STA $3f58
                 LDA TBITS,X
                 LDX $3f57
                 ORA TDECALL,X
                 STA $3f57
                 LDA TBITS,X
                 LDX $3f56
                 ORA TDECALL,X
                 STA $3f56
                 LDA TBITS,X
                 LDX $3f55
                 ORA TDECALL,X
                 STA $3f55
                 LDA TBITS,X
                 LDX $3f54
                 ORA TDECALL,X
                 STA $3f54
                 LDA TBITS,X
                 LDX $3f53
                 ORA TDECALL,X
                 STA $3f53
                 LDA TBITS,X
                 LDX $3f52
                 ORA TDECALL,X
                 STA $3f52
                 LDA TBITS,X
                 LDX $3f51
                 ORA TDECALL,X
                 STA $3f51
                 LDA TBITS,X
                 LDX $3f50
                 ORA TDECALL,X
                 STA $3f50

modline3                 LDA #$AC
                 LDX $27f7
                 ORA TDECALL,X
                 STA $27f7
                 LDA TBITS,X
                 LDX $27f6
                 ORA TDECALL,X
                 STA $27f6
                 LDA TBITS,X
                 LDX $27f5
                 ORA TDECALL,X
                 STA $27f5
                 LDA TBITS,X
                 LDX $27f4
                 ORA TDECALL,X
                 STA $27f4
                 LDA TBITS,X
                 LDX $27f3
                 ORA TDECALL,X
                 STA $27f3
                 LDA TBITS,X
                 LDX $27f2
                 ORA TDECALL,X
                 STA $27f2
                 LDA TBITS,X
                 LDX $27f1
                 ORA TDECALL,X
                 STA $27f1
                 LDA TBITS,X
                 LDX $27f0
                 ORA TDECALL,X
                 STA $27f0
                 LDA TBITS,X
                 LDX $27ef
                 ORA TDECALL,X
                 STA $27ef
                 LDA TBITS,X
                 LDX $27ee
                 ORA TDECALL,X
                 STA $27ee
                 LDA TBITS,X
                 LDX $27ed
                 ORA TDECALL,X
                 STA $27ed
                 LDA TBITS,X
                 LDX $27ec
                 ORA TDECALL,X
                 STA $27ec
                 LDA TBITS,X
                 LDX $27eb
                 ORA TDECALL,X
                 STA $27eb
                 LDA TBITS,X
                 LDX $27ea
                 ORA TDECALL,X
                 STA $27ea
                 LDA TBITS,X
                 LDX $27e9
                 ORA TDECALL,X
                 STA $27e9
                 LDA TBITS,X
                 LDX $27e8
                 ORA TDECALL,X
                 STA $27e8
                 LDA TBITS,X
                 LDX $27e7
                 ORA TDECALL,X
                 STA $27e7
                 LDA TBITS,X
                 LDX $27e6
                 ORA TDECALL,X
                 STA $27e6
                 LDA TBITS,X
                 LDX $27e5
                 ORA TDECALL,X
                 STA $27e5
                 LDA TBITS,X
                 LDX $27e4
                 ORA TDECALL,X
                 STA $27e4
                 LDA TBITS,X
                 LDX $27e3
                 ORA TDECALL,X
                 STA $27e3
                 LDA TBITS,X
                 LDX $27e2
                 ORA TDECALL,X
                 STA $27e2
                 LDA TBITS,X
                 LDX $27e1
                 ORA TDECALL,X
                 STA $27e1
                 LDA TBITS,X
                 LDX $27e0
                 ORA TDECALL,X
                 STA $27e0
                 LDA TBITS,X
                 LDX $27df
                 ORA TDECALL,X
                 STA $27df
                 LDA TBITS,X
                 LDX $27de
                 ORA TDECALL,X
                 STA $27de
                 LDA TBITS,X
                 LDX $27dd
                 ORA TDECALL,X
                 STA $27dd
                 LDA TBITS,X
                 LDX $27dc
                 ORA TDECALL,X
                 STA $27dc
                 LDA TBITS,X
                 LDX $27db
                 ORA TDECALL,X
                 STA $27db
                 LDA TBITS,X
                 LDX $27da
                 ORA TDECALL,X
                 STA $27da
                 LDA TBITS,X
                 LDX $27d9
                 ORA TDECALL,X
                 STA $27d9
                 LDA TBITS,X
                 LDX $27d8
                 ORA TDECALL,X
                 STA $27d8
                 LDA TBITS,X
                 LDX $27d7
                 ORA TDECALL,X
                 STA $27d7
                 LDA TBITS,X
                 LDX $27d6
                 ORA TDECALL,X
                 STA $27d6
                 LDA TBITS,X
                 LDX $27d5
                 ORA TDECALL,X
                 STA $27d5
                 LDA TBITS,X
                 LDX $27d4
                 ORA TDECALL,X
                 STA $27d4
                 LDA TBITS,X
                 LDX $27d3
                 ORA TDECALL,X
                 STA $27d3
                 LDA TBITS,X
                 LDX $27d2
                 ORA TDECALL,X
                 STA $27d2
                 LDA TBITS,X
                 LDX $27d1
                 ORA TDECALL,X
                 STA $27d1
                 LDA TBITS,X
                 LDX $27d0
                 ORA TDECALL,X
                 STA $27d0

modline4                 LDA #$AC
                 LDX $2ff7
                 ORA TDECALL,X
                 STA $2ff7
                 LDA TBITS,X
                 LDX $2ff6
                 ORA TDECALL,X
                 STA $2ff6
                 LDA TBITS,X
                 LDX $2ff5
                 ORA TDECALL,X
                 STA $2ff5
                 LDA TBITS,X
                 LDX $2ff4
                 ORA TDECALL,X
                 STA $2ff4
                 LDA TBITS,X
                 LDX $2ff3
                 ORA TDECALL,X
                 STA $2ff3
                 LDA TBITS,X
                 LDX $2ff2
                 ORA TDECALL,X
                 STA $2ff2
                 LDA TBITS,X
                 LDX $2ff1
                 ORA TDECALL,X
                 STA $2ff1
                 LDA TBITS,X
                 LDX $2ff0
                 ORA TDECALL,X
                 STA $2ff0
                 LDA TBITS,X
                 LDX $2fef
                 ORA TDECALL,X
                 STA $2fef
                 LDA TBITS,X
                 LDX $2fee
                 ORA TDECALL,X
                 STA $2fee
                 LDA TBITS,X
                 LDX $2fed
                 ORA TDECALL,X
                 STA $2fed
                 LDA TBITS,X
                 LDX $2fec
                 ORA TDECALL,X
                 STA $2fec
                 LDA TBITS,X
                 LDX $2feb
                 ORA TDECALL,X
                 STA $2feb
                 LDA TBITS,X
                 LDX $2fea
                 ORA TDECALL,X
                 STA $2fea
                 LDA TBITS,X
                 LDX $2fe9
                 ORA TDECALL,X
                 STA $2fe9
                 LDA TBITS,X
                 LDX $2fe8
                 ORA TDECALL,X
                 STA $2fe8
                 LDA TBITS,X
                 LDX $2fe7
                 ORA TDECALL,X
                 STA $2fe7
                 LDA TBITS,X
                 LDX $2fe6
                 ORA TDECALL,X
                 STA $2fe6
                 LDA TBITS,X
                 LDX $2fe5
                 ORA TDECALL,X
                 STA $2fe5
                 LDA TBITS,X
                 LDX $2fe4
                 ORA TDECALL,X
                 STA $2fe4
                 LDA TBITS,X
                 LDX $2fe3
                 ORA TDECALL,X
                 STA $2fe3
                 LDA TBITS,X
                 LDX $2fe2
                 ORA TDECALL,X
                 STA $2fe2
                 LDA TBITS,X
                 LDX $2fe1
                 ORA TDECALL,X
                 STA $2fe1
                 LDA TBITS,X
                 LDX $2fe0
                 ORA TDECALL,X
                 STA $2fe0
                 LDA TBITS,X
                 LDX $2fdf
                 ORA TDECALL,X
                 STA $2fdf
                 LDA TBITS,X
                 LDX $2fde
                 ORA TDECALL,X
                 STA $2fde
                 LDA TBITS,X
                 LDX $2fdd
                 ORA TDECALL,X
                 STA $2fdd
                 LDA TBITS,X
                 LDX $2fdc
                 ORA TDECALL,X
                 STA $2fdc
                 LDA TBITS,X
                 LDX $2fdb
                 ORA TDECALL,X
                 STA $2fdb
                 LDA TBITS,X
                 LDX $2fda
                 ORA TDECALL,X
                 STA $2fda
                 LDA TBITS,X
                 LDX $2fd9
                 ORA TDECALL,X
                 STA $2fd9
                 LDA TBITS,X
                 LDX $2fd8
                 ORA TDECALL,X
                 STA $2fd8
                 LDA TBITS,X
                 LDX $2fd7
                 ORA TDECALL,X
                 STA $2fd7
                 LDA TBITS,X
                 LDX $2fd6
                 ORA TDECALL,X
                 STA $2fd6
                 LDA TBITS,X
                 LDX $2fd5
                 ORA TDECALL,X
                 STA $2fd5
                 LDA TBITS,X
                 LDX $2fd4
                 ORA TDECALL,X
                 STA $2fd4
                 LDA TBITS,X
                 LDX $2fd3
                 ORA TDECALL,X
                 STA $2fd3
                 LDA TBITS,X
                 LDX $2fd2
                 ORA TDECALL,X
                 STA $2fd2
                 LDA TBITS,X
                 LDX $2fd1
                 ORA TDECALL,X
                 STA $2fd1
                 LDA TBITS,X
                 LDX $2fd0
                 ORA TDECALL,X
                 STA $2fd0

modline5                 LDA #$AC
                 LDX $37f7
                 ORA TDECALL,X
                 STA $37f7
                 LDA TBITS,X
                 LDX $37f6
                 ORA TDECALL,X
                 STA $37f6
                 LDA TBITS,X
                 LDX $37f5
                 ORA TDECALL,X
                 STA $37f5
                 LDA TBITS,X
                 LDX $37f4
                 ORA TDECALL,X
                 STA $37f4
                 LDA TBITS,X
                 LDX $37f3
                 ORA TDECALL,X
                 STA $37f3
                 LDA TBITS,X
                 LDX $37f2
                 ORA TDECALL,X
                 STA $37f2
                 LDA TBITS,X
                 LDX $37f1
                 ORA TDECALL,X
                 STA $37f1
                 LDA TBITS,X
                 LDX $37f0
                 ORA TDECALL,X
                 STA $37f0
                 LDA TBITS,X
                 LDX $37ef
                 ORA TDECALL,X
                 STA $37ef
                 LDA TBITS,X
                 LDX $37ee
                 ORA TDECALL,X
                 STA $37ee
                 LDA TBITS,X
                 LDX $37ed
                 ORA TDECALL,X
                 STA $37ed
                 LDA TBITS,X
                 LDX $37ec
                 ORA TDECALL,X
                 STA $37ec
                 LDA TBITS,X
                 LDX $37eb
                 ORA TDECALL,X
                 STA $37eb
                 LDA TBITS,X
                 LDX $37ea
                 ORA TDECALL,X
                 STA $37ea
                 LDA TBITS,X
                 LDX $37e9
                 ORA TDECALL,X
                 STA $37e9
                 LDA TBITS,X
                 LDX $37e8
                 ORA TDECALL,X
                 STA $37e8
                 LDA TBITS,X
                 LDX $37e7
                 ORA TDECALL,X
                 STA $37e7
                 LDA TBITS,X
                 LDX $37e6
                 ORA TDECALL,X
                 STA $37e6
                 LDA TBITS,X
                 LDX $37e5
                 ORA TDECALL,X
                 STA $37e5
                 LDA TBITS,X
                 LDX $37e4
                 ORA TDECALL,X
                 STA $37e4
                 LDA TBITS,X
                 LDX $37e3
                 ORA TDECALL,X
                 STA $37e3
                 LDA TBITS,X
                 LDX $37e2
                 ORA TDECALL,X
                 STA $37e2
                 LDA TBITS,X
                 LDX $37e1
                 ORA TDECALL,X
                 STA $37e1
                 LDA TBITS,X
                 LDX $37e0
                 ORA TDECALL,X
                 STA $37e0
                 LDA TBITS,X
                 LDX $37df
                 ORA TDECALL,X
                 STA $37df
                 LDA TBITS,X
                 LDX $37de
                 ORA TDECALL,X
                 STA $37de
                 LDA TBITS,X
                 LDX $37dd
                 ORA TDECALL,X
                 STA $37dd
                 LDA TBITS,X
                 LDX $37dc
                 ORA TDECALL,X
                 STA $37dc
                 LDA TBITS,X
                 LDX $37db
                 ORA TDECALL,X
                 STA $37db
                 LDA TBITS,X
                 LDX $37da
                 ORA TDECALL,X
                 STA $37da
                 LDA TBITS,X
                 LDX $37d9
                 ORA TDECALL,X
                 STA $37d9
                 LDA TBITS,X
                 LDX $37d8
                 ORA TDECALL,X
                 STA $37d8
                 LDA TBITS,X
                 LDX $37d7
                 ORA TDECALL,X
                 STA $37d7
                 LDA TBITS,X
                 LDX $37d6
                 ORA TDECALL,X
                 STA $37d6
                 LDA TBITS,X
                 LDX $37d5
                 ORA TDECALL,X
                 STA $37d5
                 LDA TBITS,X
                 LDX $37d4
                 ORA TDECALL,X
                 STA $37d4
                 LDA TBITS,X
                 LDX $37d3
                 ORA TDECALL,X
                 STA $37d3
                 LDA TBITS,X
                 LDX $37d2
                 ORA TDECALL,X
                 STA $37d2
                 LDA TBITS,X
                 LDX $37d1
                 ORA TDECALL,X
                 STA $37d1
                 LDA TBITS,X
                 LDX $37d0
                 ORA TDECALL,X
                 STA $37d0		
; -------------------------------------------------------------------------------------------------		
		RTS
; =================================================================================================
INIT	
		LDA #>ScrollText	
		STA mod_letter+2			
		LDA #<ScrollText
		STA mod_letter+1
		LDA #5+1				; row for space	
		STA row
		LDA #00
            	STA L0
            	STA L1
            	STA L2
            	STA L3
            	STA L4
		STA L5
		STA IndexBar1
		STA IndexDataPic
		STA IndexLineColor	
		STA IndexColor
		STA IndexSlice
		STA countswap
		STA indexswap
		LDA #YPIC
		STA IndexLinePic
		LDA #128
		STA IndexBar2
		LDA #64
		STA IndexBar3
		LDA #192
		STA IndexBar4
		STA indexsineff4
		LDA #$FF
		STA count
		LDA #02
		STA count2
		STA count3	
		RTS
; =================================================================================================
!align 255,0

TDECALL 	!byte  128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 129, 129, 128, 128, 130, 128, 130, 128, 128, 128, 128, 128, 132, 132, 128, 128, 133, 133, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 136, 136, 136, 128, 137, 137, 128, 128, 138, 138, 138, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 144, 144, 144, 128, 145, 128, 128, 128, 146, 128, 146, 128, 128, 128, 128, 128, 148, 148, 148, 128, 149, 149, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128
TBITS	!byte 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 192, 160, 128, 128, 192, 128, 128, 128, 128, 160, 128, 128, 128, 128, 128, 128, 192, 128, 128, 128, 192, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 192, 160, 128, 128, 192, 128, 128, 128, 192, 160, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 192, 160, 128, 128, 128, 128, 128, 128, 128, 160, 128, 128, 128, 128, 128, 128, 192, 160, 128, 128, 192, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128

TLINE0 !byte 0, 15, 15, 15, 7, 15, 15, 15, 9, 1, 4, 9, 1, 27, 17, 15, 15, 15, 15, 15, 31, 9, 9, 21, 9, 9, 15, 0, 0, 0, 1, 1, 0, 0, 7, 2, 7, 5, 10, 14, 119
TLINE1 !byte 0, 9, 9, 1, 9, 1, 1, 1, 9, 1, 4, 9, 1, 31, 19, 9, 9, 9, 9, 1, 4, 9, 9, 21, 9, 9, 8, 0, 0, 0, 1, 0, 0, 56, 5, 3, 4, 5, 10, 17, 20
TLINE2 !byte 0, 9, 9, 1, 9, 1, 1, 1, 9, 1, 4, 5, 1, 21, 23, 9, 9, 9, 9, 1, 4, 9, 9, 21, 9, 9, 4, 0, 0, 1, 1, 1, 2, 44, 5, 2, 4, 10, 5, 8, 20
TLINE3 !byte 0, 15, 15, 1, 9, 7, 7, 13, 15, 1, 4, 3, 1, 21, 29, 9, 15, 9, 15, 15, 4, 9, 9, 21, 6, 15, 2, 0, 2, 0, 1, 1, 7, 52, 5, 2, 7, 0, 0, 4, 20
TLINE4 !byte 0, 9, 9, 1, 9, 1, 1, 9, 9, 1, 5, 5, 1, 21, 25, 9, 1, 13, 5, 8, 4, 9, 6, 31, 9, 6, 1, 0, 2, 1, 0, 1, 2, 28, 5, 2, 1, 0, 0, 0, 20
TLINE5 !byte 0, 9, 15, 15, 7, 15, 1, 15, 9, 1, 7, 9, 7, 21, 17, 15, 1, 15, 9, 15, 4, 15, 6, 27, 9, 6, 15, 1, 1, 0, 1, 1, 0, 0, 7, 2, 7, 0, 0, 4, 119
TNBROW !byte 5, 5, 5, 5, 5, 5, 5, 5, 5, 2, 4, 5, 4, 6, 6, 5, 5, 5, 5, 5, 6, 5, 5, 6, 5, 5, 5, 2, 3, 4, 2, 2, 4, 8, 4, 3, 4, 5, 5, 6, 8

!convtab "specialtxt.bin" {
ScrollText
		!Text "                          ",0x25,"OLDSKOOL FORT ET VERT",0x26," FOR APPLE & RELEASED AT SHADOW PARTY 2021! CODE+GFX:GROUiK*MUSIC:DUBMOOD+ZOOM. GREETZ TO ARKOS*BRUTAL DELUXE*COSINE*DEFENCE FORCE*DESIRE*IMPHOBIA*NINJAFORCE. DO YOU THINK YOU CAN DO BETTER GFX ? I AGREE... SO CONTACT US!"
		!byte $FF
}
; -------------------------------------------------------------------------------------------------
EFFECT1		; starfield 3D
!zone
XMIN = 70
XMAX = 175
YMIN = 60
YMAX = 125

		LDA #$0F
		STA IndexStar
L_STARS
		LDX IndexStar
		LDA TNewStar,X
		BNE .s0				
		JMP .NEWSTAR				
		
		; erase old star
.s0		LDA TSaveYLo,X
		STA .OFF1+1
		LDA TSaveYHi,X
		STA .OFF1+2
		
		LDY TAbscisse,X
		LDA TableABS,Y
		TAY
		LDA #00
.OFF1		STA $2000,Y

		; compute new coord
		LDA TAbscisse,X
		CLC
		ADC TAddABS,X
		LDY TDeplacement,X
		BPL .go1
		CLC
		ADC TAddABS,X
		
.go1		CMP #XMIN
		BCC .ns1
		CMP #XMAX
		BCC .s1
.ns1		JMP .NEWSTAR
		
.s1		STA TAbscisse,X

		LDA TOrdonne,X
		CLC
		ADC TAddORD,X
		LDY TDeplacement,X
		BPL .go2
		CLC
		ADC TAddORD,X
		
.go2		CMP #YMIN
		BCC .ns2
		CMP #YMAX
		BCC .s2
.ns2		JMP .NEWSTAR
		
.s2		STA TOrdonne,X
		
.DISPLAYSTAR
		LDY TAbscisse,X
		LDA TableByteStar,Y
		DEC TDeplacement,X
		BPL .go4
		
		CMP #$40
		BEQ .go3
		INY
		ORA TableByteStar,Y
		JMP .go4
.go3		DEY
		ORA TableByteStar,Y
.go4
		STA .OFF2+1
		LDA TOrdonne,X
		TAY
		LDA THB,Y
		STA .OFF3+1
		STA TSaveYLo,X
		LDA THH,Y
		STA .OFF3+2
		STA TSaveYHi,X
		
		LDY TAbscisse,X
		LDA TableABS,Y
		TAY
.OFF2		LDA #$00
.OFF3		STA $2000,Y
 		
 		DEC IndexStar
 		BMI .go5
 		JMP L_STARS		
.go5 	
		RTS
 ; --------------------------------------------------------		
.NEWSTAR
		LDA $C404
		AND #07
		TAY
		LDA TNewABS,Y
		STA TAbscisse,X
		LDA TNewAdd,Y
		STA TAddABS,X
		
		LDA $C405
		AND #07
		TAY
		LDA TNewORD,Y
		STA TOrdonne,X
		LDA TNewAdd,Y
		STA TAddORD,X
		
		LDA #$1A
		STA TDeplacement,X
		STA TNewStar,X
		JMP .DISPLAYSTAR
; -------------------------------------------------------------------------------------------------
!align 255,0

full_hgr		; 34 CYCLES 
!zone
		STA $C057				; 4
		LDA $AC
		LDA #00				; 2				
		STA TBUFFER,X			; 5
		INX 				; 2
		NOP : NOP : NOP : NOP 		; 8
		LDA $AC		 		; 3  
		RTS				; 6

full_gr		; 38 CYCLES
!zone
		STA $C056				; 4
		NOP				; 2
		; 32 cycles
full_gr2		LDA #00				; 2				
		STA TBUFFER,X			; 5
		INX 				; 2
		NOP : NOP : NOP			; 6 
		NOP : NOP : LDA $AC 		; 7
		NOP : NOP				; 4
		RTS				; 6
; =============================================================================
!align 255,0
		
TableSinus
	!by 154,155,155,156,156,157,157,157,157,158,158,158,158,158,158,158
      !by 158,158,157,157,157,156,156,156,155,154,154,153,153,152,151,150
      !by 149,148,148,147,146,144,143,142,141,140,139,137,136,135,133,132
      !by 130,129,127,126,124,123,121,119,118,116,114,112,111,109,107,105
      !by 103,102,100,98,96,94,92,90,88,86,84,82,81,79,77,75
      !by 73,71,69,67,65,63,61,59,58,56,54,52,50,48,47,45
      !by 43,41,40,38,36,35,33,32,30,29,27,26,24,23,22,20
      !by 19,18,16,15,14,13,12,11,10,9,8,7,7,6,5,4
      !by 4,3,3,2,2,1,1,1,1,0,0,0,0,0,0,0
      !by 0,0,1,1,1,2,2,2,3,4,4,5,5,6,7,8
      !by 9,10,10,11,12,14,15,16,17,18,19,21,22,23,25,26
      !by 28,29,31,32,34,35,37,39,40,42,44,46,47,49,51,53
      !by 55,56,58,60,62,64,66,68,70,72,74,76,77,79,81,83
      !by 85,87,89,91,93,95,97,99,100,102,104,106,108,110,111,113
      !by 115,117,118,120,122,123,125,126,128,129,131,132,134,135,136,138
      !by 139,140,142,143,144,145,146,147,148,149,150,151,151,152,153,154
 
 
TableSinSens
	!byte 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
 	
TBUFFER 	!fill 192,01	
		
		
; =============================================================================
THB     !byte 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
        !byte 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80
        !byte 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
        !byte 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80
        !byte 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
        !byte 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80
        !byte 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
        !byte 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80
        !byte 0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28
        !byte 0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8
        !byte 0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28
        !byte 0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8
        !byte 0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28
        !byte 0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8
        !byte 0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28
        !byte 0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8,0xA8
        !byte 0x50,0x50,0x50,0x50,0x50,0x50,0x50,0x50
        !byte 0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0
        !byte 0x50,0x50,0x50,0x50,0x50,0x50,0x50,0x50
        !byte 0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0
        !byte 0x50,0x50,0x50,0x50,0x50,0x50,0x50,0x50
        !byte 0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0
        !byte 0x50,0x50,0x50,0x50,0x50,0x50,0x50,0x50
        !byte 0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0,0xD0
        
THH     !byte 0x20,0x24,0x28,0x2C,0x30,0x34,0x38,0x3C
        !byte 0x20,0x24,0x28,0x2C,0x30,0x34,0x38,0x3C
        !byte 0x21,0x25,0x29,0x2D,0x31,0x35,0x39,0x3D
        !byte 0x21,0x25,0x29,0x2D,0x31,0x35,0x39,0x3D
        !byte 0x22,0x26,0x2A,0x2E,0x32,0x36,0x3A,0x3E
        !byte 0x22,0x26,0x2A,0x2E,0x32,0x36,0x3A,0x3E
        !byte 0x23,0x27,0x2B,0x2F,0x33,0x37,0x3B,0x3F
        !byte 0x23,0x27,0x2B,0x2F,0x33,0x37,0x3B,0x3F
        !byte 0x20,0x24,0x28,0x2C,0x30,0x34,0x38,0x3C
        !byte 0x20,0x24,0x28,0x2C,0x30,0x34,0x38,0x3C
        !byte 0x21,0x25,0x29,0x2D,0x31,0x35,0x39,0x3D
        !byte 0x21,0x25,0x29,0x2D,0x31,0x35,0x39,0x3D
        !byte 0x22,0x26,0x2A,0x2E,0x32,0x36,0x3A,0x3E
        !byte 0x22,0x26,0x2A,0x2E,0x32,0x36,0x3A,0x3E
        !byte 0x23,0x27,0x2B,0x2F,0x33,0x37,0x3B,0x3F
        !byte 0x23,0x27,0x2B,0x2F,0x33,0x37,0x3B,0x3F
        !byte 0x20,0x24,0x28,0x2C,0x30,0x34,0x38,0x3C
        !byte 0x20,0x24,0x28,0x2C,0x30,0x34,0x38,0x3C
        !byte 0x21,0x25,0x29,0x2D,0x31,0x35,0x39,0x3D
        !byte 0x21,0x25,0x29,0x2D,0x31,0x35,0x39,0x3D
        !byte 0x22,0x26,0x2A,0x2E,0x32,0x36,0x3A,0x3E
        !byte 0x22,0x26,0x2A,0x2E,0x32,0x36,0x3A,0x3E
        !byte 0x23,0x27,0x2B,0x2F,0x33,0x37,0x3B,0x3F
        !byte 0x23,0x27,0x2B,0x2F,0x33,0x37,0x3B,0x3F

TableABS
		!byte $00,$00,$00,$00,$00,$00,$00
		!byte $01,$01,$01,$01,$01,$01,$01
		!byte $02,$02,$02,$02,$02,$02,$02
		!byte $03,$03,$03,$03,$03,$03,$03
		!byte $04,$04,$04,$04,$04,$04,$04
		!byte $05,$05,$05,$05,$05,$05,$05
		!byte $06,$06,$06,$06,$06,$06,$06
		!byte $07,$07,$07,$07,$07,$07,$07
		!byte $08,$08,$08,$08,$08,$08,$08
		!byte $09,$09,$09,$09,$09,$09,$09
		!byte $0a,$0a,$0a,$0a,$0a,$0a,$0a
		!byte $0b,$0b,$0b,$0b,$0b,$0b,$0b
		!byte $0c,$0c,$0c,$0c,$0c,$0c,$0c
		!byte $0d,$0d,$0d,$0d,$0d,$0d,$0d
		!byte $0e,$0e,$0e,$0e,$0e,$0e,$0e
		!byte $0f,$0f,$0f,$0f,$0f,$0f,$0f
		!byte $10,$10,$10,$10,$10,$10,$10
		!byte $11,$11,$11,$11,$11,$11,$11
		!byte $12,$12,$12,$12,$12,$12,$12
		!byte $13,$13,$13,$13,$13,$13,$13
		!byte $14,$14,$14,$14,$14,$14,$14
		!byte $15,$15,$15,$15,$15,$15,$15
		!byte $16,$16,$16,$16,$16,$16,$16
		!byte $17,$17,$17,$17,$17,$17,$17
		!byte $18,$18,$18,$18,$18,$18,$18
		!byte $19,$19,$19,$19,$19,$19,$19
		!byte $1a,$1a,$1a,$1a,$1a,$1a,$1a
		!byte $1b,$1b,$1b,$1b,$1b,$1b,$1b
		!byte $1c,$1c,$1c,$1c,$1c,$1c,$1c
		!byte $1d,$1d,$1d,$1d,$1d,$1d,$1d
		!byte $1e,$1e,$1e,$1e,$1e,$1e,$1e
		!byte $1f,$1f,$1f,$1f,$1f,$1f,$1f
		!byte $20,$20,$20,$20,$20,$20,$20
		!byte $21,$21,$21,$21,$21,$21,$21
		!byte $22,$22,$22,$22,$22,$22,$22
		!byte $23,$23,$23,$23,$23,$23,$23
		!byte $24,$24,$24,$24

TableByteStar
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08,$10,$20,$40
		!byte $01,$02,$04,$08
		
; =============================================================================
; for each star:
TSaveYLo		!byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
TSaveYHi 		!byte $20,$20,$20,$20,$20,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00

TAbscisse		!byte XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX,XMAX
TOrdonne		!byte YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX,YMAX

TAddABS		!byte $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01
TAddORD		!byte $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01

TDeplacement 	!byte $1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A,$1A
TNewStar		!byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00

; new star:
TNewABS		!byte $73,$76,$7D,$84,$8B,$8B,$92,$94
TNewORD		!byte $42,$46,$51,$52,$57,$5C,$62,$65

TNewAdd		!byte $FE,$FE,$FE,$FF,$01,$02,$02,$03	
		
; =============================================================================
NOEFFECT		RTS
; =============================================================================
EFFECT2		; display PIC
YPIC = 75
XPIC = 11
!zone
		LDX IndexLinePic
mod_effect2_1	CPX #(YPIC+32)
		BEQ +		; do nothing
		LDA THB,X
		STA .mod_dest+1
		LDA THH,X
		STA .mod_dest+2
		INX
		INX
		STX IndexLinePic

		LDY IndexDataPic
		LDX #XPIC
mod_picture
.loop		LDA FT_PIC,Y 
.mod_dest		STA $0000,X
		INY
		INX
		CPX #(XPIC+15)
		BNE .loop
		STY IndexDataPic
+		RTS
; -----------------------------------------------------------------------------
FT_PIC		!byte 124, 127, 67, 127, 15, 126, 127, 97, 3, 6, 124, 127, 112, 1, 3, 112, 127, 115, 127, 63, 120, 127, 121, 79, 31, 124, 127, 124, 103, 15, 124, 1, 112, 31, 60, 126, 0, 120, 79, 31, 63, 0, 124, 103, 15, 124, 127, 115, 127, 63, 126, 127, 121, 79, 31, 63, 0, 124, 127, 15, 124, 127, 115, 127, 15, 126, 127, 121, 127, 31, 63, 0, 124, 127, 15, 124, 1, 112, 127, 63, 126, 0, 120, 127, 31, 63, 0, 124, 103, 15, 124, 1, 112, 31, 63, 126, 127, 121, 79, 31, 127, 127, 124, 103, 15, 124, 1, 64, 7, 12, 126, 127, 97, 3, 6, 124, 127, 112, 1, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 120, 127, 1, 127, 7, 60, 120, 64, 127, 15, 30, 60, 0, 0, 0, 126, 127, 121, 15, 30, 63, 120, 124, 7, 64, 31, 60, 0, 0, 0, 96, 15, 120, 15, 30, 63, 120, 124, 7, 64, 127, 63, 0, 0, 0, 96, 15, 120, 15, 30, 63, 120, 124, 7, 64, 127, 63, 0, 0, 0, 96, 15, 120, 15, 30, 63, 120, 124, 7, 64, 31, 60, 0, 0, 0, 96, 15, 120, 127, 31, 127, 127, 124, 127, 67, 31, 60, 0, 0, 0, 96, 15, 96, 127, 7, 127, 127, 112, 127, 79, 31, 60, 0, 0
PRESENT_PIC	!byte 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 126, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 31, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 70, 127, 67, 127, 67, 127, 67, 127, 67, 127, 67, 99, 115, 127, 27, 118, 103, 115, 103, 115, 7, 112, 7, 112, 7, 112, 103, 3, 30, 24, 118, 103, 115, 127, 112, 127, 115, 127, 115, 127, 115, 127, 3, 30, 24, 118, 127, 112, 127, 112, 7, 0, 96, 115, 7, 112, 127, 3, 30, 24, 118, 7, 112, 103, 115, 127, 115, 127, 115, 127, 115, 115, 3, 30, 24, 118, 1, 112, 103, 115, 127, 112, 127, 112, 127, 112, 97, 3, 30, 24, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 126, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
OLD_PIC		!byte 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 124, 127, 124, 1, 127, 31, 127, 103, 127, 103, 127, 121, 63, 126, 0, 12, 96, 76, 1, 3, 24, 3, 102, 24, 102, 64, 25, 48, 102, 0, 12, 96, 76, 1, 3, 24, 3, 102, 24, 102, 64, 25, 48, 102, 0, 76, 103, 76, 1, 51, 24, 115, 103, 0, 102, 76, 25, 51, 102, 0, 76, 103, 76, 1, 115, 25, 115, 103, 0, 102, 76, 25, 51, 102, 0, 76, 103, 76, 1, 115, 25, 3, 102, 96, 103, 76, 25, 51, 102, 0, 76, 103, 76, 1, 115, 25, 3, 102, 0, 102, 76, 25, 51, 102, 0, 76, 103, 76, 1, 51, 24, 63, 102, 0, 102, 76, 25, 51, 102, 0, 12, 96, 76, 31, 3, 24, 3, 102, 24, 102, 64, 25, 48, 102, 15, 12, 96, 12, 24, 3, 24, 3, 102, 24, 102, 64, 25, 48, 6, 12, 124, 127, 124, 31, 127, 31, 127, 103, 127, 103, 127, 121, 63, 126, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 96, 24, 86, 101, 96, 48, 48, 13, 75, 97, 0, 0, 0, 0, 0, 96, 24, 86, 99, 96, 48, 112, 13, 71, 97, 0, 0, 0
; =============================================================================
EFFECT3		; change GR Colors
!zone
		LDX IndexLineColor
		LDA TTL,X
		STA .mod_dest+1
		LDA TTH,X
		STA .mod_dest+2
		INX
		CPX #24
		BNE +
		LDX #00
+		STX IndexLineColor

		LDX #39
		LDA IndexColor
mod_color		ORA #$CF
-
.mod_dest		STA $0000,X
		DEX
		BPL -

		LDX IndexColor
		INX
		CPX #$10
		BNE +
		LDX #00
+		STX IndexColor
		RTS		
				
TTH		!byte $04,$04,$05,$05,$06,$06,$07,$07,$04,$04,$05,$05,$06,$06,$07,$07,$04,$04,$05,$05,$06,$06,$07,$07
TTL  		!byte $00,$80,$00,$80,$00,$80,$00,$80,$28,$A8,$28,$A8,$28,$A8,$28,$A8,$50,$D0,$50,$D0,$50,$D0,$50,$D0
; =============================================================================		
EFFECT4		; OLDSKOOL appearance
!zone	
		LDX IndexLinePic
		CPX #(YPIC+32)
		BEQ ++			; reinit

		LDA THB,X
		STA .mod_dest+1
		LDA THH,X
		STA .mod_dest+2
		INX
		INX
		STX IndexLinePic
		
		LDX indexsineff4
		LDA TableSinus,X
		STA .mod_sin+1
		INC indexsineff4
		LDY IndexDataPic

		LDX #XPIC

.lx		LDA #$17
.mod_sin		CMP #$AC
		BCC +
		LDA OLD_PIC,Y
		!byte $2C
+		LDA #00
.mod_dest		STA $0000,X
		LDA .lx+1
		ADC #$E7
		STA .lx+1
		INY
		INX
		CPX #(XPIC+15)
		BNE .lx
		STY IndexDataPic
		RTS

++		LDA #YPIC
		STA IndexLinePic
		LDA #00 
		STA IndexDataPic
		RTS
; =============================================================================
SWAPAN3
!zone
mod_swap		RTS			; RTS/NOP ($60/$EA)
		LDA countswap		; during a swap ?
		BNE +
		DEC count3
		BNE .skip
		LDA #DURATION
		STA countswap		; init swap timing
		INC indexswap
		LDX indexswap
		LDA TableSwap,X		; reinit count3
		STA count3
		LDA #$5E			; active swap
		STA mod_AN3_1+1
		STA mod_AN3_2+1
		STA mod_AN3_3+1
		RTS

		; during a swap
+		DEC countswap
		BNE .skip	
		LDA #$5F			; desactive swap
		STA mod_AN3_1+1
		STA mod_AN3_2+1
		STA mod_AN3_3+1
.skip		RTS
; -----------------------------------------------------------------------------
DURATION = 3
TableSwap		!byte 0,16-DURATION,64-DURATION, 40-DURATION, 16-DURATION, 8-DURATION, 64-DURATION, 32-DURATION,4-DURATION,4-DURATION,4-DURATION,4-DURATION,4-DURATION,4-DURATION,4-DURATION
		!byte 32-DURATION,32-DURATION,32-DURATION,32-DURATION,32-DURATION,32-DURATION,32-DURATION,8-DURATION,8-DURATION,4-DURATION,4-DURATION,4-DURATION,4-DURATION,4-DURATION,4-DURATION
; =============================================================================